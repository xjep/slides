<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zahlengerade Interaktiv</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        padding: 20px;
        background: #f8f9fa;
      }
      #zahlengerade {
        position: relative;
        height: 100px;
        margin: 40px 0;
      }
      .tick {
        position: absolute;
        width: 2px;
        background: black;
        bottom: 50px;
      }
      .tickLabel {
        position: absolute;
        bottom: 55px;
        text-align: center;
        transform: translateX(-50%);
        font-size: 14px;
      }
      .inputBox {
        position: absolute;
        bottom: 65px;
        width: 50px;
        text-align: center;
        font-size: 14px;
        transform: translateX(-50%);
      }
      select,
      button {
        margin: 5px 10px 5px 0;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>Zahlengerade Übung</h2>
    <label for="difficulty">Schwierigkeit:</label>
    <select id="difficulty">
      <option value="easy">Einfach</option>
      <option value="intermediate">Mittel</option>
      <option value="hard">Schwer</option>
    </select>

    <div id="zahlengerade"></div>
    <button id="checkBtn">Antwort prüfen</button>
    <p>Punkte: <span id="score">0</span></p>

    <script>
      let score = 0;
      let currentExercise = null;

      function generateNumberLine() {
        const container = document.getElementById("zahlengerade");
        container.innerHTML = "";
        const difficulty = document.getElementById("difficulty").value;

        let factors;
        if (difficulty === "easy") factors = [1];
        else if (difficulty === "intermediate") factors = [10, 100, 1000];
        else factors = [2, 5, 20, 50, 200, 500, 2000, 5000];

        const factor = factors[Math.floor(Math.random() * factors.length)];
        const spacing = 65;
        const tickCount = 12;
        const totalWidth = spacing * (tickCount - 1);
        container.style.width = totalWidth + "px";

        const startNum = Math.floor(Math.random() * 20) * factor;
        const numbers = [];
        for (let i = 0; i < tickCount; i++) numbers.push(startNum + i * factor);

        // choose 2 pre-filled numbers
        const filledIndices = [];
        while (filledIndices.length < 2) {
          const idx = Math.floor(Math.random() * tickCount);
          if (!filledIndices.includes(idx)) filledIndices.push(idx);
        }

        // choose 4 input positions from remaining indices
        const blankIndices = [];
        while (blankIndices.length < 4) {
          const idx = Math.floor(Math.random() * tickCount);
          if (!filledIndices.includes(idx) && !blankIndices.includes(idx))
            blankIndices.push(idx);
        }

        currentExercise = { numbers, filledIndices, blankIndices };

        // draw black horizontal line
        const line = document.createElement("div");
        line.style.position = "absolute";
        line.style.top = "50px";
        line.style.left = "0px";
        line.style.width = totalWidth + "px";
        line.style.height = "2px";
        line.style.backgroundColor = "black";
        container.appendChild(line);

        for (let i = 0; i < tickCount; i++) {
          const x = i * spacing;

          // tick height
          const tick = document.createElement("div");
          tick.className = "tick";
          tick.style.left = x + "px";
          tick.style.height = "20px";
          container.appendChild(tick);

          if (filledIndices.includes(i)) {
            const label = document.createElement("div");
            label.className = "tickLabel";
            label.style.left = x + "px";
            label.style.bottom = "77px"; // <-- raised to match input boxes
            label.textContent = numbers[i];
            container.appendChild(label);
          } else if (blankIndices.includes(i)) {
            const input = document.createElement("input");
            input.type = "number";
            input.className = "inputBox";
            input.style.left = x + "px";
            input.style.bottom = "75px"; // already at correct height
            container.appendChild(input);
          }

          // else: leave tick without number or input
        }

        document.getElementById("checkBtn").disabled = false;
      }

      function checkAnswers() {
        const inputs = document.querySelectorAll("#zahlengerade .inputBox");
        let correct = 0;
        let answered = 0;

        inputs.forEach((input, i) => {
          const val = parseInt(input.value);
          if (!isNaN(val)) answered++;
          const correctVal =
            currentExercise.numbers[currentExercise.blankIndices[i]];
          if (val === correctVal) {
            input.style.backgroundColor = "#b2fab4";
            correct++;
          } else if (!isNaN(val)) {
            input.style.backgroundColor = "#f29b9b";
          } else {
            input.style.backgroundColor = "#f29b9b";
          }
          input.value = correctVal;
        });

        let difficulty = document.getElementById("difficulty").value;
        let points =
          difficulty === "easy" ? 1 : difficulty === "intermediate" ? 2 : 3;
        score += correct * points;
        score -=
          (inputs.length - correct - (inputs.length - answered)) * points;

        document.getElementById("score").textContent = score;
        document.getElementById("checkBtn").disabled = true;
      }

      document
        .getElementById("difficulty")
        .addEventListener("change", generateNumberLine);
      document
        .getElementById("checkBtn")
        .addEventListener("click", checkAnswers);

      generateNumberLine();
    </script>
  </body>
</html>
